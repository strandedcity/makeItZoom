THREE.CSS3DObject=function(a){THREE.Object3D.call(this);this.element=a;this.element.style.position="absolute";this.addEventListener("removed",function(a){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype);THREE.CSS3DSprite=function(a){THREE.CSS3DObject.call(this,a)};THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype);
THREE.CSS3DRenderer=function(a){var c,e,n,u,b=new THREE.Matrix4,p=0,q="",r={},f=document.createElement("div");a&&(f=a);f.style.overflow="hidden";f.style.WebkitTransformStyle="preserve-3d";f.style.MozTransformStyle="preserve-3d";f.style.oTransformStyle="preserve-3d";f.style.transformStyle="preserve-3d";this.domElement=f;var h=document.createElement("div");h.style.WebkitTransformStyle="preserve-3d";h.style.MozTransformStyle="preserve-3d";h.style.oTransformStyle="preserve-3d";h.style.transformStyle=
"preserve-3d";f.appendChild(h);this.setClearColor=function(){};this.setSize=function(b,a){c=b;e=a;n=c/2;u=e/2;f.style.width=b+"px";f.style.height=a+"px";h.style.width=b+"px";h.style.height=a+"px"};var d=function(b){return 1E-6>Math.abs(b)?0:b},t=function(b){b=b.elements;return"translate3d(-50%,-50%,0) matrix3d("+d(b[0])+","+d(b[1])+","+d(b[2])+","+d(b[3])+","+d(-b[4])+","+d(-b[5])+","+d(-b[6])+","+d(-b[7])+","+d(b[8])+","+d(b[9])+","+d(b[10])+","+d(b[11])+","+d(b[12])+","+d(b[13])+","+d(b[14])+","+
d(b[15])+")"},w=function(a,d){if(a instanceof THREE.CSS3DObject){var c;a instanceof THREE.CSS3DSprite?(b.copy(d.matrixWorldInverse),b.transpose(),b.copyPosition(a.matrixWorld),b.scale(a.scale),b.elements[3]=0,b.elements[7]=0,b.elements[11]=0,b.elements[15]=1,c=t(b)):c=t(a.matrixWorld);var e=a.element,f=r[a.id];if(void 0===f||f!==c)e.style.WebkitTransform=c,e.style.MozTransform=c,e.style.oTransform=c,e.style.transform=c,r[a.id]=c;e.parentNode!==h&&h.appendChild(e)}c=0;for(e=a.children.length;c<e;c++)w(a.children[c],
d)};this.render=function(b,a){var c=.5/Math.tan(THREE.Math.degToRad(.5*a.fov))*e;p!==c&&(f.style.WebkitPerspective=c+"px",f.style.MozPerspective=c+"px",f.style.oPerspective=c+"px",f.style.perspective=c+"px",p=c);b.updateMatrixWorld();void 0===a.parent&&a.updateMatrixWorld();a.matrixWorldInverse.getInverse(a.matrixWorld);var g;g=a.matrixWorldInverse.elements;g="matrix3d("+d(g[0])+","+d(-g[1])+","+d(g[2])+","+d(g[3])+","+d(g[4])+","+d(-g[5])+","+d(g[6])+","+d(g[7])+","+d(g[8])+","+d(-g[9])+","+d(g[10])+
","+d(g[11])+","+d(g[12])+","+d(-g[13])+","+d(g[14])+","+d(g[15])+")";c="translate3d(0,0,"+c+"px)"+g+" translate3d("+n+"px,"+u+"px, 0)";q!==c&&(h.style.WebkitTransform=c,h.style.MozTransform=c,h.style.oTransform=c,q=h.style.transform=c);w(b,a)}};THREE.OrbitControls=function(a,c){function e(k){if(!1!==b.enabled){k.preventDefault();if(m===l.DOLLY){if(!0===b.noZoom)return;t.set(k.clientX,k.clientY);w.subVectors(t,d);0<w.y?b.dollyIn():b.dollyOut();d.copy(t)}else if(m===l.PAN){if(!0===b.noPan)return;q.set(k.clientX,k.clientY);r.subVectors(q,p);b.pan(r.x,r.y);p.copy(q)}b.update()}}function n(k){if(!1!==b.enabled){if(2==k.button&&"undefined"!==b.rightClick&&130>new Date-b.rightClick.time){k=b.rightClick.originalEvent;var a=new CustomEvent("mz_contextmenu"),
c;for(c in k)k.hasOwnProperty(c)&&(a[c]=k[c]);k.target.dispatchEvent(a)}document.removeEventListener("mousemove",e,!1);document.removeEventListener("mouseup",n,!1);b.dispatchEvent(y);m=l.NONE}}function u(k){!0===b.zoomTowardMouse&&(b.clientX=k.clientX,b.clientY=k.clientY,b.recenterCursor=!0);if(!1!==b.enabled&&!0!==b.noZoom){var a=0;void 0!==k.wheelDelta?a=k.wheelDelta:void 0!==k.detail&&(a=-k.detail);0<a?b.dollyOut():b.dollyIn();b.update();b.dispatchEvent(z);b.dispatchEvent(y)}}this.object=a;this.domElement=
void 0!==c?c:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.zoomTowardMouse=!0;this.minZoomScale=.05;this.currentZoomScale=this.maxZoomScale=1;this.panButton=2;this.noPan=!1;this.keyPanSpeed=7;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var b=this,p=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,f=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector2,t=new THREE.Vector2,w=new THREE.Vector2,v=1,x=new THREE.Vector3,
A=new THREE.Vector3,g=new THREE.Quaternion,l={NONE:-1,DOLLY:1,PAN:2,TOUCH_DOLLY:4,TOUCH_PAN:5},m=l.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)).clone().inverse();var B={type:"change"},z={type:"start"},y={type:"end"};this.setScale=function(b){v=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight/b/this.object.position.z};this.panLeft=function(b){var a=this.object.matrix.elements;
f.set(a[0],a[1],a[2]);f.multiplyScalar(-b);x.add(f)};this.panUp=function(b){var a=this.object.matrix.elements;f.set(a[4],a[5],a[6]);f.multiplyScalar(b);x.add(f)};this.pan=function(a,c){var e=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var d=b.object.position.clone().sub(b.target).length(),d=d*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*d/e.clientHeight);b.panUp(2*c*d/e.clientHeight)}else void 0!==b.object.top?(b.panLeft(a*(b.object.right-b.object.left)/
e.clientWidth),b.panUp(c*(b.object.top-b.object.bottom)/e.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));v/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));v*=a};this.unproject=function(a){var c=new THREE.Vector3;c.set(b.clientX/b.domElement.clientWidth*2-1,2*-(b.clientY/b.domElement.clientHeight)+1,.5);c.unproject(a);var c=c.sub(a.position).normalize(),
e=-a.position.z/c.z;return a.position.clone().add(c.multiplyScalar(e))};this.update=function(a){var c;b.recenterCursor&&(c=b.unproject(this.object).clone());var e=this.object.position;h.copy(e).sub(this.target);var d=h.length()*v,f=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight;h.z=Math.max(f/this.maxZoomScale,Math.min(f/this.minZoomScale,d));b.currentZoomScale=f/h.z;this.target.add(x);e.copy(this.target).add(h);v=1;x.set(0,0,0);if(!0===b.recenterCursor&&!0!==a)b.recenterCursor=
!1,this.object.updateMatrixWorld(),a=b.unproject(this.object).sub(c),b.panLeft(a.x),b.panUp(-a.y),b.update();else if(1E-6<A.distanceToSquared(this.object.position)||1E-6<8*(1-g.dot(this.object.quaternion)))this.dispatchEvent(B),A.copy(this.object.position),g.copy(this.object.quaternion)};this.reset=function(){m=l.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("mousedown",function(a){if(!1!==b.enabled){if(1===a.button){if(!0===
b.noZoom)return;a.preventDefault();m=l.DOLLY;d.set(a.clientX,a.clientY)}else if(a.button===b.panButton){if(!0===b.noPan)return;a.preventDefault();m=l.PAN;p.set(a.clientX,a.clientY);b.rightClick={time:new Date,originalEvent:a}}document.addEventListener("mousemove",e,!1);document.addEventListener("mouseup",n,!1);b.dispatchEvent(z)}},!1);this.domElement.addEventListener("mousewheel",u,!1);this.domElement.addEventListener("DOMMouseScroll",u,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==
b.enabled){switch(a.touches.length){case 1:return;case 2:if(!0===b.noZoom)return;m=l.TOUCH_DOLLY;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);d.set(0,c);break;case 3:if(!0===b.noPan)return;m=l.TOUCH_PAN;p.set(a.touches[0].pageX,a.touches[0].pageY);break;default:m=l.NONE}b.dispatchEvent(z)}},!1);this.domElement.addEventListener("touchend",function(){!1!==b.enabled&&(b.dispatchEvent(y),m=l.NONE)},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:break;case 2:if(!0===b.noZoom)break;if(m!==l.TOUCH_DOLLY)break;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);t.set(0,c);w.subVectors(t,d);0<w.y?b.dollyOut():b.dollyIn();d.copy(t);b.update();break;case 3:if(!0===b.noPan)break;if(m!==l.TOUCH_PAN)break;q.set(a.touches[0].pageX,a.touches[0].pageY);r.subVectors(q,p);b.pan(r.x,r.y);p.copy(q);b.update();
break;default:m=l.NONE}},!1);window.addEventListener("keydown",function(a){if(!1!==b.enabled&&!0!==b.noKeys&&!0!==b.noPan)switch(a.keyCode){case b.keys.UP:b.pan(0,b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:b.pan(0,-b.keyPanSpeed);b.update();break;case b.keys.LEFT:b.pan(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:b.pan(-b.keyPanSpeed,0),b.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);function makeItZoom(a){this.init(a||{})}
makeItZoom.prototype.init=function(a){var c={};c.containerId=a.containerId||"makeItZoom";c.maxZoomScale=a.maxZoomScale||1;c.minZoomScale=a.minZoomScale||.1;c.zoomSpeed=a.zoomSpeed||2;c.zoomTowardMouse=!1!==a.zoomTowardMouse;c.panButton="undefined"!=typeof a.panButton?a.panButton:2;c.disableNativeContextMenu="boolean"===typeof a.disableNativeContextMenu?a.disableNativeContextMenu:!0;this.options=c;this.container=document.getElementById(c.containerId);this.width=this.container.offsetWidth;this.height=
this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(70,this.width/this.height,1,1E6);this.camera.position.z=1200;this.scene=new THREE.Scene;this.renderer=new THREE.CSS3DRenderer;this.renderer.setSize(this.width,this.height);document.body.appendChild(this.renderer.domElement);this.renderer.domElement.className="makeitzoom_container";this.render=this.render.bind(this);this.attachControls();this.importDOM.call(this,this.container);this.render()};makeItZoom.prototype.getContainer=function(){return this.container};
makeItZoom.prototype.importDOM=function(a){var c=this;this.childElementIterator(a,function(a){a.mzOffset=c.getOffset(a)});this.childElementIterator(a,function(a){c._addZoomable.call(c,a,a.mzOffset)})};makeItZoom.prototype.childElementIterator=function(a,c){for(var e=a.children,n=0;n<e.length;n++)c.call(this,e[n])};
makeItZoom.prototype.attachControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);this.controls.zoomSpeed=this.options.zoomSpeed;this.controls.minZoomScale=this.options.minZoomScale;this.controls.maxZoomScale=this.options.maxZoomScale;this.controls.zoomTowardMouse=this.options.zoomTowardMouse;this.controls.panButton=this.options.panButton;!0===this.options.disableNativeContextMenu&&this.controls.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},
!1);this.controls.addEventListener("change",this.render);this.render()};makeItZoom.prototype.render=function(){this.renderer.render(this.scene,this.camera);var a=new CustomEvent("mz_render");a.mz_center_x=this.controls.object.position.x;a.mz_scale=this.controls.currentZoomScale;this.container.dispatchEvent(a);a.mz_center_y=this.controls.object.position.y};makeItZoom.prototype._addZoomable=function(a,c){var e=new THREE.CSS3DObject(a);e.position.x=c.left;e.position.y=c.top;e.position.z=0;this.scene.add(e)};
makeItZoom.prototype.addZoomable=function(a,c){this._addZoomable(a,c);this.render()};makeItZoom.prototype.removeZoomable=function(a){for(var c=null,e=0;e<this.scene.children.length;e++)this.scene.children[e].element===a&&(c=this.scene.children[e]);null!==c?this.scene.remove(c):console.warn("The specified element could not be removed from the makeItZoom workspace, because it couldn't be found.");this.render()};
makeItZoom.prototype.getOffset=function(a){for(var c=0,e=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,e+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:e,left:c}};makeItZoom.prototype.getCurrentScale=function(){return this.controls.currentZoomScale};
makeItZoom.prototype.zoomTo=function(a,c,e){var n=this.controls.object.position.x,u=this.controls.object.position.y,b=this.controls.currentZoomScale;"number"!==typeof a&&(a=n);"number"!==typeof c&&(c=u);"number"!==typeof e&&(e=b);this.controls.panLeft(n-a);this.controls.panUp(c-u);this.controls.setScale(e);this.controls.update(!0)};window.makeItZoom=makeItZoom;makeItZoom.prototype.addZoomable=makeItZoom.prototype.addZoomable;makeItZoom.prototype.removeZoomable=makeItZoom.prototype.removeZoomable;
makeItZoom.prototype.zoomTo=makeItZoom.prototype.zoomTo;makeItZoom.prototype.getCurrentScale=makeItZoom.prototype.getCurrentScale;makeItZoom.prototype.getOffset=makeItZoom.prototype.getOffset;makeItZoom.prototype.getContainer=makeItZoom.prototype.getContainer;
