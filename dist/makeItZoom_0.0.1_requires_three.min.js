THREE.CSS2DObject=function(a){THREE.Object3D.call(this);this.element=a;this.element.style.position="absolute";this.addEventListener("removed",function(a){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};THREE.CSS2DObject.prototype=Object.create(THREE.Object3D.prototype);
THREE.CSS2DRenderer=function(a){var c,d=!0,e=0,p="",b={},m=1,h=document.createElement("div");a&&(h=a);h.style.overflow="hidden";this.domElement=h;var f=document.createElement("div");h.appendChild(f);this.setClearColor=function(){};this.setIsHardwareAccelerated=function(b){d=b};this.setSize=function(b,a){c=a;h.style.width=b+"px";h.style.height=a+"px";f.style.width=b+"px";f.style.height=a+"px"};var n=function(a,d){if(a instanceof THREE.CSS2DObject){var c=a.element,e=b[a.id];if(void 0===e||""!==e)c.style.WebkitTransform=
"",c.style.MozTransform="",c.style.oTransform="",c.style.transform="",b[a.id]="";c.parentNode!==f&&f.appendChild(c)}c=0;for(e=a.children.length;c<e;c++)n(a.children[c],d)};this.render=function(b,a){var g=.5/Math.tan(THREE.Math.degToRad(.5*a.fov))*c;e!==g&&(e=g);b.updateMatrixWorld();void 0===a.parent&&a.updateMatrixWorld();a.matrixWorldInverse.getInverse(a.matrixWorld);g=" scale("+this.getCurrentZoomScale(a,h)+") translate("+-a.position.x+"px,"+a.position.y+"px)"+(d?" translate3d(0,0,0)":"");p!==
g&&(f.style.WebkitTransform=g,f.style.MozTransform=g,f.style.oTransform=g,p=f.style.transform=g);n(b,a)};this.getCurrentZoomScale=function(b,a){var c=m;if(0!==a.clientHeight||"undefined"===typeof m)m=c=.5/Math.tan(THREE.Math.degToRad(.5*b.fov))*a.clientHeight;return c/b.position.z}};THREE.OrbitControls=function(a,c){function d(a){if(!1!==b.enabled){a.preventDefault();if(l===k.DOLLY){if(!0===b.noZoom)return;g.set(a.clientX,a.clientY);u.subVectors(g,r);0<u.y?b.dollyIn():b.dollyOut();r.copy(g)}else if(l===k.PAN){if(!0===b.noPan)return;h.set(a.clientX,a.clientY);f.subVectors(h,m);b.pan(f.x,f.y);m.copy(h)}b.update()}}function e(a){if(!1!==b.enabled){if(2==a.button&&"undefined"!==b.rightClick&&130>new Date-b.rightClick.time){a=b.rightClick.originalEvent;var c=new CustomEvent("mz_contextmenu");
c.clientX=a.clientX;c.clientY=a.clientY;c.target=a.target;a.target.dispatchEvent(c)}document.removeEventListener("mousemove",d,!1);document.removeEventListener("mouseup",e,!1);b.dispatchEvent(w);l=k.NONE}}function p(a){!0===b.zoomTowardMouse&&(b.clientX=a.clientX,b.clientY=a.clientY,b.recenterCursor=!0);if(!1!==b.enabled&&!0!==b.noZoom){var c=0;void 0!==a.wheelDelta?c=a.wheelDelta:void 0!==a.detail&&(c=-a.detail);0<c?b.dollyOut():b.dollyIn();b.update();b.dispatchEvent(x);b.dispatchEvent(w)}}this.object=
a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.zoomTowardMouse=!0;this.minZoomScale=.05;this.currentZoomScale=this.maxZoomScale=1;this.panButton=2;this.noPan=!1;this.keyPanSpeed=7;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var b=this,m=new THREE.Vector2,h=new THREE.Vector2,f=new THREE.Vector2,n=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector2,g=new THREE.Vector2,u=new THREE.Vector2,q=
1,v=new THREE.Vector3,y=new THREE.Vector3,z=new THREE.Quaternion,k={NONE:-1,DOLLY:1,PAN:2,TOUCH_DOLLY:4,TOUCH_PAN:5},l=k.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)).clone().inverse();var A={type:"change"},x={type:"start"},w={type:"end"};this.setScale=function(b){q=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight/b/this.object.position.z};this.panLeft=function(b){var a=
this.object.matrix.elements;n.set(a[0],a[1],a[2]);n.multiplyScalar(-b);v.add(n)};this.panUp=function(b){var a=this.object.matrix.elements;n.set(a[4],a[5],a[6]);n.multiplyScalar(b);v.add(n)};this.pan=function(a,c){var d=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var e=b.object.position.clone().sub(b.target).length(),e=e*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*e/d.clientHeight);b.panUp(2*c*e/d.clientHeight)}else void 0!==b.object.top?(b.panLeft(a*(b.object.right-
b.object.left)/d.clientWidth),b.panUp(c*(b.object.top-b.object.bottom)/d.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));q/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));q*=a};this.unproject=function(a){var c=new THREE.Vector3;c.set(b.clientX/b.domElement.clientWidth*2-1,2*-(b.clientY/b.domElement.clientHeight)+1,.5);c.unproject(a);var c=c.sub(a.position).normalize(),
d=-a.position.z/c.z;return a.position.clone().add(c.multiplyScalar(d))};this.update=function(a){var c;b.recenterCursor&&(c=b.unproject(this.object).clone());var d=this.object.position;t.copy(d).sub(this.target);var e=t.length()*q,f=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight;t.z=Math.max(f/this.maxZoomScale,Math.min(f/this.minZoomScale,e));b.currentZoomScale=f/t.z;this.target.add(v);d.copy(this.target).add(t);q=1;v.set(0,0,0);if(!0===b.recenterCursor&&!0!==a)b.recenterCursor=
!1,this.object.updateMatrixWorld(),a=b.unproject(this.object).sub(c),b.panLeft(a.x),b.panUp(-a.y),b.update();else if(1E-6<y.distanceToSquared(this.object.position)||1E-6<8*(1-z.dot(this.object.quaternion)))this.dispatchEvent(A),y.copy(this.object.position),z.copy(this.object.quaternion)};this.reset=function(){l=k.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("mousedown",function(a){if(!1!==b.enabled){if(1===a.button){if(!0===
b.noZoom)return;a.preventDefault();l=k.DOLLY;r.set(a.clientX,a.clientY)}else if(a.button===b.panButton){if(!0===b.noPan)return;a.preventDefault();l=k.PAN;m.set(a.clientX,a.clientY);b.rightClick={time:new Date,originalEvent:a}}document.addEventListener("mousemove",d,!1);document.addEventListener("mouseup",e,!1);b.dispatchEvent(x)}},!1);this.domElement.addEventListener("mousewheel",p,!1);this.domElement.addEventListener("DOMMouseScroll",p,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==
b.enabled){switch(a.touches.length){case 1:return;case 2:if(!0===b.noZoom)return;l=k.TOUCH_DOLLY;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);r.set(0,c);break;case 3:if(!0===b.noPan)return;l=k.TOUCH_PAN;m.set(a.touches[0].pageX,a.touches[0].pageY);break;default:l=k.NONE}b.dispatchEvent(x)}},!1);this.domElement.addEventListener("touchend",function(){!1!==b.enabled&&(b.dispatchEvent(w),l=k.NONE)},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:break;case 2:if(!0===b.noZoom)break;if(l!==k.TOUCH_DOLLY)break;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);g.set(0,c);u.subVectors(g,r);0<u.y?b.dollyOut():b.dollyIn();r.copy(g);b.update();break;case 3:if(!0===b.noPan)break;if(l!==k.TOUCH_PAN)break;h.set(a.touches[0].pageX,a.touches[0].pageY);f.subVectors(h,m);b.pan(f.x,f.y);m.copy(h);b.update();
break;default:l=k.NONE}},!1);window.addEventListener("keydown",function(a){if(!1!==b.enabled&&!0!==b.noKeys&&!0!==b.noPan)switch(a.keyCode){case b.keys.UP:b.pan(0,b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:b.pan(0,-b.keyPanSpeed);b.update();break;case b.keys.LEFT:b.pan(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:b.pan(-b.keyPanSpeed,0),b.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);(function(){function a(a,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");e.initCustomEvent(a,d.bubbles,d.cancelable,d.detail);return e}"undefined"===window.CustomEvent&&(a.prototype=window.Event.prototype,window.CustomEvent=a)})();function makeItZoom(a){this.init(a||{})}
makeItZoom.prototype.init=function(a){var c={};c.containerId=a.containerId||"makeItZoom";c.maxZoomScale=a.maxZoomScale||1;c.minZoomScale=a.minZoomScale||.1;c.zoomSpeed=a.zoomSpeed||2;c.zoomTowardMouse=!1!==a.zoomTowardMouse;c.panButton="undefined"!=typeof a.panButton?a.panButton:2;c.disableNativeContextMenu="boolean"===typeof a.disableNativeContextMenu?a.disableNativeContextMenu:!0;c.hardwareAccelerated=!1!==a.hardwareAccelerated;c.fullScreen=!0===a.fullScreen;this.options=c;this.container=document.getElementById(c.containerId);
this.width=this.container.offsetWidth;this.height=this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(70,this.width/this.height,1,1E6);this.scene=new THREE.Scene;this.renderer=new THREE.CSS2DRenderer;this.renderer.setSize(this.width,this.height);this.renderer.setIsHardwareAccelerated(c.hardwareAccelerated);this.container.parentNode.insertBefore(this.renderer.domElement,this.container);this.container.parentNode.insertBefore(this.container,this.renderer.domElement);this.renderer.domElement.className=
"makeitzoom_container";this.render=this.render.bind(this);this.attachControls();this.controls.setScale(1);this.importDOM.call(this,this.container);this.render();this.setFullScreen(c.fullScreen)};
makeItZoom.prototype.setFullScreen=function(a){function c(){d.container.style.width=window.innerWidth;d.container.style.height=window.innerHeight;d.width=d.container.offsetWidth;d.height=d.container.offsetHeight;d.camera.aspect=window.innerWidth/window.innerHeight;d.camera.updateProjectionMatrix();d.renderer.setSize(window.innerWidth,window.innerHeight);d.render()}var d=this;!0===a?(c(),window.addEventListener("resize",c,!1)):window.removeEventListener("resize",c,!1)};
makeItZoom.prototype.getContainer=function(){return this.container};makeItZoom.prototype.importDOM=function(a){var c=this;this.childElementIterator(a,function(a){a.mzOffset=c.getOffset(a)});this.childElementIterator(a,function(a){c._addZoomable.call(c,a,a.mzOffset)})};makeItZoom.prototype.childElementIterator=function(a,c){for(var d=a.children,e=0;e<d.length;e++)c.call(this,d[e])};
makeItZoom.prototype.attachControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);this.controls.zoomSpeed=this.options.zoomSpeed;this.controls.minZoomScale=this.options.minZoomScale;this.controls.maxZoomScale=this.options.maxZoomScale;this.controls.zoomTowardMouse=this.options.zoomTowardMouse;this.controls.panButton=this.options.panButton;!0===this.options.disableNativeContextMenu&&this.controls.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},
!1);this.controls.addEventListener("change",this.render);this.render()};makeItZoom.prototype.render=function(){this.renderer.render(this.scene,this.camera);var a=new CustomEvent("mz_render");a.mz_scale=this.controls.currentZoomScale;a.mz_center_x=this.controls.object.position.x;a.mz_center_y=this.controls.object.position.y;this.container.dispatchEvent(a)};makeItZoom.prototype._addZoomable=function(a,c){var d=new THREE.CSS2DObject(a);d.position.x=c.left;d.position.y=c.top;d.position.z=0;this.scene.add(d)};
makeItZoom.prototype.addZoomable=function(a,c){this._addZoomable(a,c);this.render()};makeItZoom.prototype.removeZoomable=function(a){for(var c=null,d=0;d<this.scene.children.length;d++)this.scene.children[d].element===a&&(c=this.scene.children[d]);null!==c?this.scene.remove(c):console.warn("The specified element could not be removed from the makeItZoom workspace, because it couldn't be found.");this.render()};
makeItZoom.prototype.getOffset=function(a){for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:c}};makeItZoom.prototype.getCurrentScale=function(){return this.controls.currentZoomScale};
makeItZoom.prototype.zoomTo=function(a,c,d){var e=this.controls.object.position.x,p=this.controls.object.position.y,b=this.controls.currentZoomScale;"number"!==typeof a&&(a=e);"number"!==typeof c&&(c=p);"number"!==typeof d&&(d=b);this.controls.panLeft(e-a);this.controls.panUp(c-p);this.controls.setScale(d);this.controls.update(!0)};window.makeItZoom=makeItZoom;makeItZoom.prototype.addZoomable=makeItZoom.prototype.addZoomable;makeItZoom.prototype.removeZoomable=makeItZoom.prototype.removeZoomable;
makeItZoom.prototype.zoomTo=makeItZoom.prototype.zoomTo;makeItZoom.prototype.getCurrentScale=makeItZoom.prototype.getCurrentScale;makeItZoom.prototype.getOffset=makeItZoom.prototype.getOffset;makeItZoom.prototype.getContainer=makeItZoom.prototype.getContainer;
