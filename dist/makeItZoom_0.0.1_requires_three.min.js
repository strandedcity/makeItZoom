THREE.CSS2DObject=function(a){THREE.Object3D.call(this);this.element=a;this.element.style.position="absolute";this.addEventListener("removed",function(a){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};THREE.CSS2DObject.prototype=Object.create(THREE.Object3D.prototype);
THREE.CSS2DRenderer=function(a){var c=1,d,f,g,p,x=!0,y=0,z="",A={},b=1,h=document.createElement("div");a&&(h=a);h.style.overflow="hidden";this.domElement=h;var k=document.createElement("div");h.appendChild(k);this.setIsHardwareAccelerated=function(b){x=b};this.setAlignment=function(b){c=1;"CENTER"===b&&(c=0)};this.setSize=function(b,a){d=b;f=a;g=d/2;p=f/2;h.style.width=b+"px";h.style.height=a+"px";k.style.width=b+"px";k.style.height=a+"px"};var r=function(b,a){if(b instanceof THREE.CSS2DObject){var c=
b.element,d=A[b.id];if(void 0===d||""!==d)c.style.WebkitTransform="",c.style.MozTransform="",c.style.oTransform="",c.style.transform="",A[b.id]="";c.parentNode!==k&&k.appendChild(c)}c=0;for(d=b.children.length;c<d;c++)r(b.children[c],a)};this.render=function(b,a){var d=.5/Math.tan(THREE.Math.degToRad(.5*a.fov))*f;y!==d&&(y=d);b.updateMatrixWorld();void 0===a.parent&&a.updateMatrixWorld();a.matrixWorldInverse.getInverse(a.matrixWorld);var d=-a.position.x,q=a.position.y;1===c&&(d+=g,q+=p);d=" scale("+
this.getCurrentZoomScale(a,h)+") translate("+d+"px,"+q+"px)"+(x?" translate3d(0,0,0)":"");z!==d&&(k.style.WebkitTransform=d,k.style.MozTransform=d,k.style.oTransform=d,z=k.style.transform=d);r(b,a)};this.getCurrentZoomScale=function(a,c){var d=b;if(0!==c.clientHeight||"undefined"===typeof b)b=d=.5/Math.tan(THREE.Math.degToRad(.5*a.fov))*c.clientHeight;return d/a.position.z}};THREE.OrbitControls=function(a,c){function d(e){if(!1!==b.enabled){if(1===e.button){if(!0===b.noZoom)return;e.preventDefault();l=m.DOLLY;w.set(e.clientX,e.clientY)}else if(e.button===b.panButton){if(!0===b.noPan)return;e.preventDefault();l=m.PAN;h.set(e.clientX,e.clientY);b.rightClick={time:new Date,originalEvent:e}}document.addEventListener("mousemove",f,!1);document.addEventListener("mouseup",g,!1);b.dispatchEvent(C)}}function f(e){if(!1!==b.enabled){e.preventDefault();if(l===m.DOLLY){if(!0===b.noZoom)return;
q.set(e.clientX,e.clientY);B.subVectors(q,w);0<B.y?b.dollyIn():b.dollyOut();w.copy(q)}else if(l===m.PAN){if(!0===b.noPan)return;k.set(e.clientX,e.clientY);r.subVectors(k,h);b.pan(r.x,r.y);h.copy(k)}b.update()}}function g(e){if(!1!==b.enabled){if(2==e.button&&"undefined"!==b.rightClick&&130>new Date-b.rightClick.time){e=b.rightClick.originalEvent;var a=new CustomEvent("mz_contextmenu");a.clientX=e.clientX;a.clientY=e.clientY;a.target=e.target;e.target.dispatchEvent(a)}document.removeEventListener("mousemove",
f,!1);document.removeEventListener("mouseup",g,!1);b.dispatchEvent(D);l=m.NONE}}function p(e){!0===b.zoomTowardMouse&&(b.clientX=e.clientX,b.clientY=e.clientY,b.recenterCursor=!0);if(!1!==b.enabled&&!0!==b.noZoom){var a=0;void 0!==e.wheelDelta?a=e.wheelDelta:void 0!==e.detail&&(a=-e.detail);0<a?b.dollyOut():b.dollyIn();b.update();b.dispatchEvent(C);b.dispatchEvent(D)}}function x(e){if(!1!==b.enabled&&!0!==b.noKeys&&!0!==b.noPan)switch(e.keyCode){case b.keys.UP:b.pan(0,b.keyPanSpeed);b.update();break;
case b.keys.BOTTOM:b.pan(0,-b.keyPanSpeed);b.update();break;case b.keys.LEFT:b.pan(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:b.pan(-b.keyPanSpeed,0),b.update()}}function y(e){if(!1!==b.enabled){switch(e.touches.length){case 1:return;case 2:if(!0===b.noZoom)return;l=m.TOUCH_DOLLY;var a=e.touches[0].pageX-e.touches[1].pageX;e=e.touches[0].pageY-e.touches[1].pageY;a=Math.sqrt(a*a+e*e);w.set(0,a);break;case 3:if(!0===b.noPan)return;l=m.TOUCH_PAN;h.set(e.touches[0].pageX,e.touches[0].pageY);
break;default:l=m.NONE}b.dispatchEvent(C)}}function z(e){if(!1!==b.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:break;case 2:if(!0===b.noZoom)break;if(l!==m.TOUCH_DOLLY)break;var a=e.touches[0].pageX-e.touches[1].pageX;e=e.touches[0].pageY-e.touches[1].pageY;a=Math.sqrt(a*a+e*e);q.set(0,a);B.subVectors(q,w);0<B.y?b.dollyOut():b.dollyIn();w.copy(q);b.update();break;case 3:if(!0===b.noPan)break;if(l!==m.TOUCH_PAN)break;k.set(e.touches[0].pageX,e.touches[0].pageY);r.subVectors(k,
h);b.pan(r.x,r.y);h.copy(k);b.update();break;default:l=m.NONE}}function A(){!1!==b.enabled&&(b.dispatchEvent(D),l=m.NONE)}this.object=a;this.domElement=void 0!==c?c:document;this._enableInteractions=this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.zoomTowardMouse=!0;this.minZoomScale=.05;this.currentZoomScale=this.maxZoomScale=1;this.bounds=null;this.panButton=2;this.noPan=!1;this.keyPanSpeed=7;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};
var b=this,h=new THREE.Vector2,k=new THREE.Vector2,r=new THREE.Vector2,v=new THREE.Vector3,u=new THREE.Vector3,w=new THREE.Vector2,q=new THREE.Vector2,B=new THREE.Vector2,t=1,n=new THREE.Vector3,E=new THREE.Vector3,F=new THREE.Quaternion,m={NONE:-1,DOLLY:1,PAN:2,TOUCH_DOLLY:4,TOUCH_PAN:5},l=m.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0));var G={type:"change"},C={type:"start"},D={type:"end"};
this.setScale=function(b){t=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight/b/this.object.position.z};this.setMaxZoomScale=function(b){this.maxZoomScale=b};this.setMinZoomScale=function(b){this.minZoomScale=null===this.bounds?b:this.calculateMinZoomScaleFromBounds(this.bounds)};this.calculateMinZoomScaleFromBounds=function(b){return Math.min(this.domElement.clientWidth/(b.right-b.left),this.domElement.clientHeight/(b.bottom-b.top))};this.validateBounds=function(b){if(null==
b||"object"!=typeof b)return null;for(var a=["top","left","bottom","right"],c=[-1,-1,1,1],d=!1,n={},f=0;f<a.length;f++)"[object Number]"===toString.call(b[a[f]])&&(d=!0),n[a[f]]="[object Number]"===toString.call(b[a[f]])?b[a[f]]:Infinity*c[f];return d?n:(THREE.warn("Invalid bounds object specified."),null)};this.setBounds=function(b){this.bounds=b=this.validateBounds(b);null!==b&&this.setMinZoomScale(1)};this.panLeft=function(b){var a=this.object.matrix.elements;v.set(a[0],a[1],a[2]);v.multiplyScalar(-b);
n.add(v)};this.panUp=function(b){var a=this.object.matrix.elements;v.set(a[4],a[5],a[6]);v.multiplyScalar(b);n.add(v)};this.pan=function(a,c){var d=b.domElement===document?b.domElement.body:b.domElement;if(void 0!==b.object.fov){var f=b.object.position.clone().sub(b.target).length(),f=f*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*f/d.clientHeight);b.panUp(2*c*f/d.clientHeight)}else void 0!==b.object.top?(b.panLeft(a*(b.object.right-b.object.left)/d.clientWidth),b.panUp(c*(b.object.top-b.object.bottom)/
d.clientHeight)):console.warn("WARNING: ZoomControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));t/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));t*=a};this.unproject=function(a){var c=new THREE.Vector3;c.set(b.clientX/b.domElement.clientWidth*2-1,2*-(b.clientY/b.domElement.clientHeight)+1,.5);c.unproject(a);var c=c.sub(a.position).normalize(),d=-a.position.z/c.z;return a.position.clone().add(c.multiplyScalar(d))};
this.update=function(a,c){var d=!1,f;b.recenterCursor&&(f=b.unproject(this.object).clone());var g=this.object.position;u.copy(g).sub(this.target);var k=u.length()*t,h=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight;u.z=Math.max(h/this.maxZoomScale,Math.min(h/this.minZoomScale,k));b.currentZoomScale=h/u.z;this.target.add(n);g.copy(this.target).add(u);t=1;n.set(0,0,0);!0===b.recenterCursor&&!0!==a&&(d=!0,b.recenterCursor=!1,this.object.updateMatrixWorld(),f=b.unproject(this.object).sub(f),
b.panLeft(f.x),b.panUp(-f.y));if(null!==b.bounds&&!0!==c){var m=h=k=f=0,l=this.domElement.clientHeight/2,p=this.domElement.clientWidth/2,q=p/l,r=u.z*Math.tan(THREE.Math.degToRad(.5*this.object.fov)),q=r*q;r-l+g.y+n.y>-b.bounds.top&&(k+=-r-b.bounds.top+l-g.y-n.y);-q+p+g.x+n.x<b.bounds.left&&(f+=q+b.bounds.left-p-g.x-n.x);+r-g.y-n.y+l>b.bounds.bottom&&(m+=+r-b.bounds.bottom+l-g.y-n.y);q+g.x+n.x+p>b.bounds.right&&(h+=-q+b.bounds.right-p-g.x-n.x);.001>Math.abs(f)&&(f=0);.001>Math.abs(h)&&(h=0);.001>Math.abs(m)&&
(m=0);.001>Math.abs(k)&&(k=0);if(0!==f||0!==k||0!==h||0!==m)d=!0,l=k+m,p=f+h,0!==k&&0!==m&&(l/=2,n.setY(0)),0!==f&&0!==h&&(p/=2,n.setX(0)),n.set(p+n.x,l+n.y,0)}d&&(this.target.add(n),g.copy(this.target).add(u),n.set(0,0,0),t=1);if(1E-6<E.distanceToSquared(this.object.position)||1E-6<8*(1-F.dot(this.object.quaternion)))this.dispatchEvent(G),E.copy(this.object.position),F.copy(this.object.quaternion)};this.reset=function(){l=m.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);
this.update()};this.enableInteractions=function(b){var a=this.domElement;b=!1!==b;var a={mousedown:{element:a,handler:d},mousewheel:{element:a,handler:p},DOMMouseScroll:{element:a,handler:p},touchstart:{element:a,handler:y},touchend:{element:a,handler:A},touchmove:{element:a,handler:z},keydown:{element:window,handler:x}},c=!1!==b?"addEventListener":"removeEventListener";if(this._enableInteractions!==b||!0!==this.__setupComplete){this.__setupComplete=!0;this._enableInteractions=b;for(var f in a)a.hasOwnProperty(f)&&
a[f].element[c].apply(a[f].element,[f,a[f].handler,!1])}}.bind(this);this.enableInteractions(this._enableInteractions);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);function makeItZoom(a){this.init(a||{})}
makeItZoom.prototype.init=function(a){var c={};c.containerId=a.containerId||"makeItZoom";c.maxZoomScale=a.maxZoomScale||1;c.minZoomScale=a.minZoomScale||.1;c.zoomSpeed=a.zoomSpeed||2;c.zoomTowardMouse=!1!==a.zoomTowardMouse;c.panButton="undefined"!=typeof a.panButton?a.panButton:2;c.disableNativeContextMenu="boolean"===typeof a.disableNativeContextMenu?a.disableNativeContextMenu:!0;c.hardwareAccelerated=!1!==a.hardwareAccelerated;c.fullScreen=!0===a.fullScreen;c.bounds=a.bounds||null;c.zeroAtCenter=
!0!==a.zeroAtCenter;c.enableUserInteractions=!1!==a.enableUserInteractions;this.options=c;this.container=document.getElementById(c.containerId);a=this.cacheElements.call(this,this.container);this.width=this.container.offsetWidth;this.height=this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(70,this.width/this.height,1,1E6);this.scene=new THREE.Scene;this.replaceElements.call(this,a);this.renderer=new THREE.CSS2DRenderer(this.container);this.renderer.setAlignment(this.options.zeroAtCenter?
"CENTER":"TOP_LEFT");this.renderer.setSize(this.width,this.height);this.renderer.setIsHardwareAccelerated(c.hardwareAccelerated);this.renderer.domElement.style.position="absolute";this.render=this.render.bind(this);this.attachControls();this.controls.setScale(1);this.setFullScreen(c.fullScreen);this.controls.update()};makeItZoom.prototype.setEnableUserInteractions=function(a){this.controls.enableInteractions(a)};
makeItZoom.prototype.setFullScreen=function(a){function c(){d.container.style.width=window.innerWidth;d.container.style.height=window.innerHeight;d.width=d.container.offsetWidth;d.height=d.container.offsetHeight;d.camera.aspect=window.innerWidth/window.innerHeight;d.camera.updateProjectionMatrix();d.renderer.setSize(window.innerWidth,window.innerHeight);d.render()}var d=this;!0===a?(c(),window.addEventListener("resize",c,!1)):window.removeEventListener("resize",c,!1)};
makeItZoom.prototype.getContainer=function(){return this.container};makeItZoom.prototype.cacheElements=function(a){var c=this,d=[];this.childElementIterator(a,function(a){var f=c.getOffset(a),g=getComputedStyle(a).getPropertyValue("position");if("relative"===g||"static"===g)a.mzOffset=f;d.push(a)});for(var f=0;f<d.length;f++){var g=d[f];a.removeChild(g);g.mzOffset&&(g.style.position="absolute",g.style.top=g.mzOffset.top+"px",g.style.left=g.mzOffset.left+"px")}return d};
makeItZoom.prototype.replaceElements=function(a){for(var c=0;c<a.length;c++){var d=a[c];this._addZoomable.call(this,d,d.mzOffset)}};makeItZoom.prototype._addZoomable=function(a,c){var d=new THREE.CSS2DObject(a);c&&(d.element.style.left=c.left+"px",d.element.style.top=c.top+"px");d.position.z=0;this.scene.add(d)};makeItZoom.prototype.childElementIterator=function(a,c){for(var d=a.children,f=0;f<d.length;f++)c.call(this,d[f])};
makeItZoom.prototype.attachControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);this.controls.zoomSpeed=this.options.zoomSpeed;this.controls.setMinZoomScale(this.options.minZoomScale);this.controls.setMaxZoomScale(this.options.maxZoomScale);this.controls.setBounds(this.options.bounds);this.controls.enableInteractions(this.options.enableUserInteractions);this.controls.zoomTowardMouse=this.options.zoomTowardMouse;this.controls.panButton=this.options.panButton;
!0===this.options.disableNativeContextMenu&&this.controls.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.controls.addEventListener("change",this.render);this.render()};makeItZoom.prototype.render=function(){this.renderer.render(this.scene,this.camera);var a={type:"mz_render"};a.mz_scale=this.controls.currentZoomScale;a.mz_center_x=this.controls.object.position.x;a.mz_center_y=this.controls.object.position.y;this.dispatchEvent(a)};
makeItZoom.prototype.addZoomable=function(a,c){this._addZoomable(a,{left:c.left,top:-c.top});this.render()};makeItZoom.prototype.removeZoomable=function(a){for(var c=null,d=0;d<this.scene.children.length;d++)this.scene.children[d].element===a&&(c=this.scene.children[d]);null!==c?this.scene.remove(c):console.warn("The specified element could not be removed from the makeItZoom workspace, because it couldn't be found.");this.render()};
makeItZoom.prototype.getOffset=function(a){for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:c}};makeItZoom.prototype.getCurrentScale=function(){return this.controls.currentZoomScale};
makeItZoom.prototype.zoomTo=function(a,c,d){var f=this.controls.object.position.x,g=this.controls.object.position.y,p=this.controls.currentZoomScale;"number"!==typeof a&&(a=f);"number"!==typeof c&&(c=g);"number"!==typeof d&&(d=p);this.controls.panLeft(f-a);this.controls.panUp(-c-g);this.controls.setScale(d);this.controls.update(!0)};makeItZoom.prototype.getScene=function(){return this.scene};makeItZoom.prototype.getCamera=function(){return this.camera};makeItZoom.prototype.getRenderer=function(){return this.renderer};
THREE.EventDispatcher.prototype.apply(makeItZoom.prototype);window.makeItZoom=makeItZoom;makeItZoom.prototype.addZoomable=makeItZoom.prototype.addZoomable;makeItZoom.prototype.removeZoomable=makeItZoom.prototype.removeZoomable;makeItZoom.prototype.zoomTo=makeItZoom.prototype.zoomTo;makeItZoom.prototype.getCurrentScale=makeItZoom.prototype.getCurrentScale;makeItZoom.prototype.getOffset=makeItZoom.prototype.getOffset;makeItZoom.prototype.getContainer=makeItZoom.prototype.getContainer;
makeItZoom.prototype.setEnableUserInteractions=makeItZoom.prototype.setEnableUserInteractions;
