THREE.CSS2DObject=function(a){THREE.Object3D.call(this);this.element=a;this.element.style.position="absolute";this.addEventListener("removed",function(a){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};THREE.CSS2DObject.prototype=Object.create(THREE.Object3D.prototype);
THREE.CSS2DRenderer=function(a){var c=1,d,e,f,b,q=!0,n=0,r="",v={},t=1,g=document.createElement("div");a&&(g=a);g.style.overflow="hidden";this.domElement=g;var h=document.createElement("div");g.appendChild(h);this.setIsHardwareAccelerated=function(b){q=b};this.setAlignment=function(b){c=1;"CENTER"===b&&(c=0)};this.setSize=function(a,c){d=a;e=c;f=d/2;b=e/2;g.style.width=a+"px";g.style.height=c+"px";h.style.width=a+"px";h.style.height=c+"px"};var x=function(b,a){if(b instanceof THREE.CSS2DObject){var c=
b.element,d=v[b.id];if(void 0===d||""!==d)c.style.WebkitTransform="",c.style.MozTransform="",c.style.oTransform="",c.style.transform="",v[b.id]="";c.parentNode!==h&&h.appendChild(c)}c=0;for(d=b.children.length;c<d;c++)x(b.children[c],a)};this.render=function(a,d){var u=.5/Math.tan(THREE.Math.degToRad(.5*d.fov))*e;n!==u&&(n=u);a.updateMatrixWorld();void 0===d.parent&&d.updateMatrixWorld();d.matrixWorldInverse.getInverse(d.matrixWorld);var u=-d.position.x,t=d.position.y;1===c&&(u+=f,t+=b);u=" scale("+
this.getCurrentZoomScale(d,g)+") translate("+u+"px,"+t+"px)"+(q?" translate3d(0,0,0)":"");r!==u&&(h.style.WebkitTransform=u,h.style.MozTransform=u,h.style.oTransform=u,r=h.style.transform=u);x(a,d)};this.getCurrentZoomScale=function(b,a){var c=t;if(0!==a.clientHeight||"undefined"===typeof t)t=c=.5/Math.tan(THREE.Math.degToRad(.5*b.fov))*a.clientHeight;return c/b.position.z}};THREE.OrbitControls=function(a,c){function d(p){if(!1!==b.enabled){p.preventDefault();if(k===m.DOLLY){if(!0===b.noZoom)return;h.set(p.clientX,p.clientY);x.subVectors(h,g);0<x.y?b.dollyIn():b.dollyOut();g.copy(h)}else if(k===m.PAN){if(!0===b.noPan)return;n.set(p.clientX,p.clientY);r.subVectors(n,q);b.pan(r.x,r.y);q.copy(n)}b.update()}}function e(p){if(!1!==b.enabled){if(2==p.button&&"undefined"!==b.rightClick&&130>new Date-b.rightClick.time){p=b.rightClick.originalEvent;var a=new CustomEvent("mz_contextmenu");
a.clientX=p.clientX;a.clientY=p.clientY;a.target=p.target;p.target.dispatchEvent(a)}document.removeEventListener("mousemove",d,!1);document.removeEventListener("mouseup",e,!1);b.dispatchEvent(y);k=m.NONE}}function f(p){!0===b.zoomTowardMouse&&(b.clientX=p.clientX,b.clientY=p.clientY,b.recenterCursor=!0);if(!1!==b.enabled&&!0!==b.noZoom){var a=0;void 0!==p.wheelDelta?a=p.wheelDelta:void 0!==p.detail&&(a=-p.detail);0<a?b.dollyOut():b.dollyIn();b.update();b.dispatchEvent(z);b.dispatchEvent(y)}}this.object=
a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.zoomTowardMouse=!0;this.minZoomScale=.05;this.currentZoomScale=this.maxZoomScale=1;this.bounds=null;this.panButton=2;this.noPan=!1;this.keyPanSpeed=7;this.noKeys=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var b=this,q=new THREE.Vector2,n=new THREE.Vector2,r=new THREE.Vector2,v=new THREE.Vector3,t=new THREE.Vector3,g=new THREE.Vector2,h=new THREE.Vector2,x=new THREE.Vector2,
w=1,l=new THREE.Vector3,u=new THREE.Vector3,A=new THREE.Quaternion,m={NONE:-1,DOLLY:1,PAN:2,TOUCH_DOLLY:4,TOUCH_PAN:5},k=m.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0));var B={type:"change"},z={type:"start"},y={type:"end"};this.setScale=function(b){w=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight/b/this.object.position.z};this.setMaxZoomScale=function(b){this.maxZoomScale=
b};this.setMinZoomScale=function(b){this.minZoomScale=null===this.bounds?b:this.calculateMinZoomScaleFromBounds(this.bounds)};this.calculateMinZoomScaleFromBounds=function(b){return Math.min(this.domElement.clientWidth/(b.right-b.left),this.domElement.clientHeight/(b.bottom-b.top))};this.validateBounds=function(b){if(null==b||"object"!=typeof b)return null;for(var a=["top","left","bottom","right"],c=[-1,-1,1,1],d=!1,l={},e=0;e<a.length;e++)"[object Number]"===toString.call(b[a[e]])&&(d=!0),l[a[e]]=
"[object Number]"===toString.call(b[a[e]])?b[a[e]]:Infinity*c[e];return d?l:(THREE.warn("Invalid bounds object specified."),null)};this.setBounds=function(b){this.bounds=b=this.validateBounds(b);null!==b&&this.setMinZoomScale(1)};this.panLeft=function(b){var a=this.object.matrix.elements;v.set(a[0],a[1],a[2]);v.multiplyScalar(-b);l.add(v)};this.panUp=function(b){var a=this.object.matrix.elements;v.set(a[4],a[5],a[6]);v.multiplyScalar(b);l.add(v)};this.pan=function(a,c){var d=b.domElement===document?
b.domElement.body:b.domElement;if(void 0!==b.object.fov){var e=b.object.position.clone().sub(b.target).length(),e=e*Math.tan(b.object.fov/2*Math.PI/180);b.panLeft(2*a*e/d.clientHeight);b.panUp(2*c*e/d.clientHeight)}else void 0!==b.object.top?(b.panLeft(a*(b.object.right-b.object.left)/d.clientWidth),b.panUp(c*(b.object.top-b.object.bottom)/d.clientHeight)):console.warn("WARNING: ZoomControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,
b.zoomSpeed));w/=a};this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,b.zoomSpeed));w*=a};this.unproject=function(a){var c=new THREE.Vector3;c.set(b.clientX/b.domElement.clientWidth*2-1,2*-(b.clientY/b.domElement.clientHeight)+1,.5);c.unproject(a);var c=c.sub(a.position).normalize(),d=-a.position.z/c.z;return a.position.clone().add(c.multiplyScalar(d))};this.update=function(a,c){var d=!1,e;b.recenterCursor&&(e=b.unproject(this.object).clone());var f=this.object.position;t.copy(f).sub(this.target);
var h=t.length()*w,g=.5/Math.tan(THREE.Math.degToRad(.5*this.object.fov))*this.domElement.clientHeight;t.z=Math.max(g/this.maxZoomScale,Math.min(g/this.minZoomScale,h));b.currentZoomScale=g/t.z;this.target.add(l);f.copy(this.target).add(t);w=1;l.set(0,0,0);!0===b.recenterCursor&&!0!==a&&(d=!0,b.recenterCursor=!1,this.object.updateMatrixWorld(),e=b.unproject(this.object).sub(e),b.panLeft(e.x),b.panUp(-e.y));if(null!==b.bounds&&!0!==c){var m=g=h=e=0,k=this.domElement.clientHeight/2,n=this.domElement.clientWidth/
2,q=n/k,r=t.z*Math.tan(THREE.Math.degToRad(.5*this.object.fov)),q=r*q;r-k+f.y+l.y>-b.bounds.top&&(h+=-r-b.bounds.top+k-f.y-l.y);-q+n+f.x+l.x<b.bounds.left&&(e+=q+b.bounds.left-n-f.x-l.x);+r-f.y-l.y+k>b.bounds.bottom&&(m+=+r-b.bounds.bottom+k-f.y-l.y);q+f.x+l.x+n>b.bounds.right&&(g+=-q+b.bounds.right-n-f.x-l.x);.001>Math.abs(e)&&(e=0);.001>Math.abs(g)&&(g=0);.001>Math.abs(m)&&(m=0);.001>Math.abs(h)&&(h=0);if(0!==e||0!==h||0!==g||0!==m)d=!0,k=h+m,n=e+g,0!==h&&0!==m&&(k/=2,l.setY(0)),0!==e&&0!==g&&(n/=
2,l.setX(0)),l.set(n+l.x,k+l.y,0)}d&&(this.target.add(l),f.copy(this.target).add(t),l.set(0,0,0),w=1);if(1E-6<u.distanceToSquared(this.object.position)||1E-6<8*(1-A.dot(this.object.quaternion)))this.dispatchEvent(B),u.copy(this.object.position),A.copy(this.object.quaternion)};this.reset=function(){k=m.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};this.domElement.addEventListener("mousedown",function(a){if(!1!==b.enabled){if(1===a.button){if(!0===b.noZoom)return;
a.preventDefault();k=m.DOLLY;g.set(a.clientX,a.clientY)}else if(a.button===b.panButton){if(!0===b.noPan)return;a.preventDefault();k=m.PAN;q.set(a.clientX,a.clientY);b.rightClick={time:new Date,originalEvent:a}}document.addEventListener("mousemove",d,!1);document.addEventListener("mouseup",e,!1);b.dispatchEvent(z)}},!1);this.domElement.addEventListener("mousewheel",f,!1);this.domElement.addEventListener("DOMMouseScroll",f,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==b.enabled){switch(a.touches.length){case 1:return;
case 2:if(!0===b.noZoom)return;k=m.TOUCH_DOLLY;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);g.set(0,c);break;case 3:if(!0===b.noPan)return;k=m.TOUCH_PAN;q.set(a.touches[0].pageX,a.touches[0].pageY);break;default:k=m.NONE}b.dispatchEvent(z)}},!1);this.domElement.addEventListener("touchend",function(){!1!==b.enabled&&(b.dispatchEvent(y),k=m.NONE)},!1);this.domElement.addEventListener("touchmove",function(a){if(!1!==b.enabled)switch(a.preventDefault(),
a.stopPropagation(),a.touches.length){case 1:break;case 2:if(!0===b.noZoom)break;if(k!==m.TOUCH_DOLLY)break;var c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);h.set(0,c);x.subVectors(h,g);0<x.y?b.dollyOut():b.dollyIn();g.copy(h);b.update();break;case 3:if(!0===b.noPan)break;if(k!==m.TOUCH_PAN)break;n.set(a.touches[0].pageX,a.touches[0].pageY);r.subVectors(n,q);b.pan(r.x,r.y);q.copy(n);b.update();break;default:k=m.NONE}},!1);window.addEventListener("keydown",
function(a){if(!1!==b.enabled&&!0!==b.noKeys&&!0!==b.noPan)switch(a.keyCode){case b.keys.UP:b.pan(0,b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:b.pan(0,-b.keyPanSpeed);b.update();break;case b.keys.LEFT:b.pan(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:b.pan(-b.keyPanSpeed,0),b.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);function makeItZoom(a){this.init(a||{})}
makeItZoom.prototype.init=function(a){var c={};c.containerId=a.containerId||"makeItZoom";c.maxZoomScale=a.maxZoomScale||1;c.minZoomScale=a.minZoomScale||.1;c.zoomSpeed=a.zoomSpeed||2;c.zoomTowardMouse=!1!==a.zoomTowardMouse;c.panButton="undefined"!=typeof a.panButton?a.panButton:2;c.disableNativeContextMenu="boolean"===typeof a.disableNativeContextMenu?a.disableNativeContextMenu:!0;c.hardwareAccelerated=!1!==a.hardwareAccelerated;c.fullScreen=!0===a.fullScreen;c.bounds=a.bounds||null;c.zeroAtCenter=
!0!==a.zeroAtCenter;this.options=c;this.container=document.getElementById(c.containerId);a=this.cacheElements.call(this,this.container);this.width=this.container.offsetWidth;this.height=this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(70,this.width/this.height,1,1E6);this.scene=new THREE.Scene;this.replaceElements.call(this,a);this.renderer=new THREE.CSS2DRenderer(this.container);this.renderer.setAlignment(this.options.zeroAtCenter?"CENTER":"TOP_LEFT");this.renderer.setSize(this.width,
this.height);this.renderer.setIsHardwareAccelerated(c.hardwareAccelerated);this.renderer.domElement.style.position="absolute";this.render=this.render.bind(this);this.attachControls();this.controls.setScale(1);this.setFullScreen(c.fullScreen);this.controls.update()};
makeItZoom.prototype.setFullScreen=function(a){function c(){d.container.style.width=window.innerWidth;d.container.style.height=window.innerHeight;d.width=d.container.offsetWidth;d.height=d.container.offsetHeight;d.camera.aspect=window.innerWidth/window.innerHeight;d.camera.updateProjectionMatrix();d.renderer.setSize(window.innerWidth,window.innerHeight);d.render()}var d=this;!0===a?(c(),window.addEventListener("resize",c,!1)):window.removeEventListener("resize",c,!1)};
makeItZoom.prototype.getContainer=function(){return this.container};makeItZoom.prototype.cacheElements=function(a){var c=this,d=[];this.childElementIterator(a,function(a){var e=c.getOffset(a),f=getComputedStyle(a).getPropertyValue("position");if("relative"===f||"static"===f)a.mzOffset=e;d.push(a)});for(var e=0;e<d.length;e++){var f=d[e];a.removeChild(f);f.mzOffset&&(f.style.position="absolute",f.style.top=f.mzOffset.top+"px",f.style.left=f.mzOffset.left+"px")}return d};
makeItZoom.prototype.replaceElements=function(a){for(var c=0;c<a.length;c++){var d=a[c];this._addZoomable.call(this,d,d.mzOffset)}};makeItZoom.prototype._addZoomable=function(a,c){var d=new THREE.CSS2DObject(a);c&&(d.element.style.left=c.left+"px",d.element.style.top=c.top+"px");d.position.z=0;this.scene.add(d)};makeItZoom.prototype.childElementIterator=function(a,c){for(var d=a.children,e=0;e<d.length;e++)c.call(this,d[e])};
makeItZoom.prototype.attachControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);this.controls.zoomSpeed=this.options.zoomSpeed;this.controls.setMinZoomScale(this.options.minZoomScale);this.controls.setMaxZoomScale(this.options.maxZoomScale);this.controls.setBounds(this.options.bounds);this.controls.zoomTowardMouse=this.options.zoomTowardMouse;this.controls.panButton=this.options.panButton;!0===this.options.disableNativeContextMenu&&this.controls.domElement.addEventListener("contextmenu",
function(a){a.preventDefault()},!1);this.controls.addEventListener("change",this.render);this.render()};makeItZoom.prototype.render=function(){this.renderer.render(this.scene,this.camera);var a={type:"mz_render"};a.mz_scale=this.controls.currentZoomScale;a.mz_center_x=this.controls.object.position.x;a.mz_center_y=this.controls.object.position.y;this.dispatchEvent(a)};makeItZoom.prototype.addZoomable=function(a,c){this._addZoomable(a,{left:c.left,top:-c.top});this.render()};
makeItZoom.prototype.removeZoomable=function(a){for(var c=null,d=0;d<this.scene.children.length;d++)this.scene.children[d].element===a&&(c=this.scene.children[d]);null!==c?this.scene.remove(c):console.warn("The specified element could not be removed from the makeItZoom workspace, because it couldn't be found.");this.render()};
makeItZoom.prototype.getOffset=function(a){for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:c}};makeItZoom.prototype.getCurrentScale=function(){return this.controls.currentZoomScale};
makeItZoom.prototype.zoomTo=function(a,c,d){var e=this.controls.object.position.x,f=this.controls.object.position.y,b=this.controls.currentZoomScale;"number"!==typeof a&&(a=e);"number"!==typeof c&&(c=f);"number"!==typeof d&&(d=b);this.controls.panLeft(e-a);this.controls.panUp(-c-f);this.controls.setScale(d);this.controls.update(!0)};makeItZoom.prototype.getScene=function(){return this.scene};makeItZoom.prototype.getCamera=function(){return this.camera};makeItZoom.prototype.getRenderer=function(){return this.renderer};
THREE.EventDispatcher.prototype.apply(makeItZoom.prototype);window.makeItZoom=makeItZoom;makeItZoom.prototype.addZoomable=makeItZoom.prototype.addZoomable;makeItZoom.prototype.removeZoomable=makeItZoom.prototype.removeZoomable;makeItZoom.prototype.zoomTo=makeItZoom.prototype.zoomTo;makeItZoom.prototype.getCurrentScale=makeItZoom.prototype.getCurrentScale;makeItZoom.prototype.getOffset=makeItZoom.prototype.getOffset;makeItZoom.prototype.getContainer=makeItZoom.prototype.getContainer;
